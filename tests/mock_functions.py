import numpy
from rasterio.io import MemoryFile


def warp_from_s3(bucket, prefix, transform, width, height, crs):
    # Prepare creation parameters for memory raster.
    dtype = 'uint8' if 'SCL' in prefix else 'uint16'
    creation_args = {
        'driver': 'GTiff',
        'dtype': dtype,
        'nodata': 0,
        'count': 1,
        'crs': crs,
        'transform': transform,
        'width': width,
        'height': height,
    }
    # Open memory destination file.
    memfile = MemoryFile()
    with memfile.open(**creation_args) as rst:
        if 'SCL' in prefix:
            fake_data = (numpy.random.random((1, height, width)) > 0.01) * 5
        else:
            fake_data = numpy.random.random((1, height, width)) * 1e4
        rst.write(fake_data.astype(dtype))
    # Return memfile.
    memfile.seek(0)
    return memfile


def search(*args, **kwargs):
    return [{'prefix': 'tiles/29/T/NG/2019/3/31/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '24.6693', 'date': '2019-03-31 11:21:19.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.832275 42.451713278350944, -8.860779 42.362461714776536, -8.907379 42.2153754989327, -8.954041 42.06841215450682, -9.000244 41.92163464909506, -9.000244 41.463751887157464, -7.6855774 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/29/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '0.4506', 'date': '2019-03-29 11:33:21.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.020477 41.458155019581305, -7.994049 41.52938842569611, -7.9406433 41.675905179396494, -7.8866577 41.8222422905784, -7.831848 41.96830841491614, -7.7761536 42.114150455781285, -7.7206116 42.260086313583926, -7.6659546 42.40360124288032, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.020477 41.458155019581305)))'}, {'prefix': 'tiles/29/T/NG/2019/3/26/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '0.0', 'date': '2019-03-26 11:21:11.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.82959 42.45169759199916, -8.86908 42.327066376158704, -8.915497 42.18012494954698, -8.961761 42.03310334906611, -9.000244 41.91063415620386, -9.000244 41.463751887157464, -7.6855774 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/24/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '3.5791', 'date': '2019-03-24 11:33:19.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.018616 41.45814430920272, -7.970154 41.59398957035183, -7.915802 41.740029598799, -7.8615723 41.88614075272564, -7.8057556 42.031909430062285, -7.7507935 42.17804298023394, -7.6950073 42.324038793427256, -7.666046 42.40002560348504, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.018616 41.45814430920272)))'}, {'prefix': 'tiles/29/T/NG/2019/3/21/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '0.0', 'date': '2019-03-21 11:21:19.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.826813 42.45168151099074, -8.833191 42.431664546601, -8.88028 42.28469606479442, -8.926941 42.137644568948495, -8.973511 41.99056621529928, -9.000244 41.90587225844048, -9.000244 41.463751887157464, -7.6855774 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/19/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '0.0592', 'date': '2019-03-19 11:33:21.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.014893 41.45812304499355, -7.9658203 41.595408708989694, -7.9115906 41.74149123190056, -7.8575745 41.88761871722184, -7.8014526 42.03324615000738, -7.746887 42.1792054633935, -7.69162 42.32502388750648, -7.6661987 42.39197241703548, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.014893 41.45812304499355)))'}, {'prefix': 'tiles/29/T/NG/2019/3/16/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '7.1188', 'date': '2019-03-16 11:21:11.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.824341 42.45166710647149, -8.833374 42.42338105699904, -8.88031 42.27638001584709, -8.926758 42.12935584966467, -8.9730835 41.98237753840376, -9.000244 41.89604575315514, -9.000244 41.463751887157464, -7.6855774 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/14/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '18.1548', 'date': '2019-03-14 11:33:19.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.013367 41.45811436000139, -8.002594 41.4873832709236, -7.949188 41.633755924196656, -7.8949585 41.779958822915845, -7.840088 41.92606689779057, -7.784027 42.07190980093972, -7.728546 42.21790372203901, -7.6740723 42.36411949334737, -7.666382 42.38382767499932, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.013367 41.45811436000139)))'}, {'prefix': 'tiles/29/T/NG/2019/3/4/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '95.4325', 'date': '2019-03-04 11:33:19.025000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.020325 41.45815418576853, -8.0155945 41.47110888911976, -7.962555 41.61761148302093, -7.9083557 41.76382908487113, -7.8530884 41.90972520866168, -7.7977905 42.05555202576855, -7.7427063 42.201442878912765, -7.6884155 42.34756285067611, -7.665924 42.40590077401754, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.020325 41.45815418576853)))'}, {'prefix': 'tiles/29/T/NG/2019/3/11/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '0.6658', 'date': '2019-03-11 11:21:09.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.834869 42.45172833640615, -8.872681 42.33219118467686, -8.918976 42.18522520564211, -8.965271 42.03824594281074, -9.000244 41.92722915727586, -9.000244 41.463751887157464, -7.6855774 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/9/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '54.0834', 'date': '2019-03-09 11:33:11.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-8.012634 41.4581102709319, -7.9730225 41.56567413789454, -7.918915 41.711636746839694, -7.8660583 41.85795300997833, -7.810669 42.00367656078663, -7.7552185 42.14950965266273, -7.7001343 42.2955884066628, -7.6664124 42.38223279285217, -7.6651 42.44491772432881, -9.000244 42.45269119915018, -9.000244 41.463751887157464, -8.012634 41.4581102709319)))'}, {'prefix': 'tiles/29/T/NG/2019/3/6/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '69.141', 'date': '2019-03-06 11:21:11.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-7.685581880652352 41.45624189757688, -7.665108433117821 42.44491772432881, -8.831476086920457 42.45170859640967, -8.858118916804928 42.368428016736885, -8.904973787210727 42.221374376193694, -8.951616079508677 42.0742844017264, -8.997924424211549 41.92715005300439, -9.00024121510575 41.91978051707789, -9.000239494303116 41.463751887157464, -7.685581880652352 41.45624189757688)))'}, {'prefix': 'tiles/29/T/NG/2019/3/1/0/', 'mgrs': '29TNG', 'processing_level': 'Level-1C', 'platform_name': 'Sentinel-2', 'max_cloud_cover_percentage': '8.1424', 'date': '2019-03-01 11:21:09.024000+00:00', 'footprint': 'SRID=4326;MULTIPOLYGON (((-9.000244 41.92061302340398, -9.000244 41.463751887157464, -7.6855774 41.45624189757688, -7.6651 42.44491772432881, -8.832886 42.451716875989874, -8.8526 42.38999807282755, -8.898956 42.24301868663454, -8.945221 42.096041900307085, -8.991333 41.94905499622782, -9.000244 41.92061302340398)))'}]
